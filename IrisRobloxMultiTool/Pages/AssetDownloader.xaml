<Page
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:IrisRobloxMultiTool.Pages"
    
      x:Class="IrisRobloxMultiTool.Pages.AssetDownloader"
      mc:Ignorable="d" 
      d:DesignHeight="880" d:DesignWidth="668"
      Title="AssetDownloader">
    <Page.Resources>
        <local:PercentToBrushConverter x:Key="PercentToBrushConverter" />
    </Page.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel >

            <ui:Card Margin="0,0,0,5">
                <StackPanel >

                    <TextBlock Text="Input Data" FontWeight="SemiBold"/>
                    <ui:TextBox
                        PlaceholderText="Enter Asset Url"
                        Name="AssetId"
                        Margin="0,10,0,0"
                        IsEnabled="{Binding IsChecked, ElementName=SingleAsset}"
                        Text="{Binding AssetDataUrl, Mode=TwoWay}" />

                    <ui:Button
                        Content="Select Input File"
                        Name="SelectInputFile"
                        Icon="Document24"
                        Margin="10,10,10,0"
                        BorderBrush="#66F32929"
                        HorizontalAlignment="Stretch"
                        Click="OpenFileDialog"
                        />
                    <ui:Button
                        Content="Clear Input File"
                        Name="ClearInputFile"
                        Visibility="Collapsed"
                        Margin="10,10,10,0"
                        HorizontalAlignment="Stretch"
                        Click="OpenFileDialog"
                    />
                </StackPanel>
            </ui:Card>

            <ui:Card Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock Margin="0,0,0,10" Text="Asset Type -> Asset Sub Type" FontWeight="SemiBold"/>
                    <ComboBox Name="BaseAssetType" IsReadOnly="True" IsSynchronizedWithCurrentItem="True" SelectedIndex="0" FontWeight="SemiBold" SelectionChanged="BaseAssetType_SelectionChanged" >
                        <ComboBoxItem Content="Accessories"/>
                        <ComboBoxItem Content="Animations"/>
                        <ComboBoxItem Content="Audio"/>
                        <ComboBoxItem Content="Body"/>
                        <ComboBoxItem Content="Clothing"/>
                        <ComboBoxItem Content="Game Asset"/>
                    </ComboBox>
                    <ComboBox Margin="0,10,0,0" Name="AssetSubTypesBox"/>
                </StackPanel>
            </ui:Card>

            <ui:Card Margin="0,0,0,5">
                <StackPanel>

                    <TextBlock Margin="0,0,0,10" Text="Output Location" FontWeight="SemiBold"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBox
                            Name="OutputBox"
                            IsReadOnly="True"
                            Grid.Column="0"
                            Margin="0,0,4,0"/>

                        <ui:Button
                            Name="SelectOutputFolder"
                            HorizontalAlignment="Stretch"
                            Content="Browse"
                            Icon="Folder24"
                            Grid.Column="1"
                            Margin="4,0,0,0"
                            Click="OpenFileDialog"/>
                    </Grid>

                </StackPanel>
            </ui:Card>

            <ui:Card>
                <StackPanel>

                    <TextBlock Text="Download Queue" FontWeight="SemiBold"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="4.6*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ui:Button
                            Content="Start Downloader"
                            Icon="ArrowDownload20"
                            IsEnabled="{Binding IsChecked, ElementName=FileInput}"
                            Margin="4,0,0,0"
                            Grid.Column="0"
                            HorizontalAlignment="Stretch"
                            Click="OpenFileDialog"
                        />

                        <ui:NumberBox
                            Name="DownloadThreads"
                            Grid.Column="1"
                            Margin="4,0,4,0"
                            HorizontalAlignment="Stretch" 
                            IntegersOnly="True"
                            Min="1"
                            Max="200" Text="10"/>
                    </Grid>

                    <ItemsControl Name="DownloadControl" ItemsSource="{Binding AssetDownloads}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" ItemWidth="120" ItemHeight="120"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ui:Card Width="120" Height="120" Margin="2" Padding="9" Background="Transparent" >
                                    <Grid>

                                        <!-- Preview Image -->
                                        <Image Source="{Binding PreviewImage}" Stretch="Uniform"/>

                                        <!-- Status Overlay -->
                                        <Grid>
                                            <Grid.Style>
                                                <Style TargetType="Grid">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Grid.Style>

                                            <Border Background="Transparent"/>
                                            <ui:SymbolIcon Symbol="{Binding StatusIcon}" FontSize="48" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Grid>

                                        <!-- Progress Bar -->
                                        <Border
                                            Height="7"
                                            Margin="0,0,0,1"
                                            BorderThickness="0"
                                            VerticalAlignment="Bottom"
                                            Background="#1F000000">
                                            <ProgressBar
                                                Value="{Binding Progress}"
                                                Maximum="100"
                                                Height="10"
                                                Foreground="{Binding Progress, Converter={StaticResource PercentToBrushConverter}}" >
                                            </ProgressBar>
                                        </Border>
                                        <TextBlock FontSize="10" Text="{Binding AssetId}"/>
                                    </Grid>
                                </ui:Card>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                </StackPanel>
            </ui:Card>

        </StackPanel>
    </ScrollViewer>
</Page>
